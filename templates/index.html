<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LightMail Premium</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel (for JSX transformation) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.20.1/babel.min.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function EmailClient() {
            const [isDark, setIsDark] = useState(false);
            const [view, setView] = useState('inbox');
            const [emails, setEmails] = useState([]);
            const [selectedEmail, setSelectedEmail] = useState(null);
            const [showCompose, setShowCompose] = useState(false);

            useEffect(() => {
                fetchEmails('inbox');
            }, []);

            const toggleTheme = () => {
                setIsDark(!isDark);
                document.documentElement.classList.toggle('dark');
            };

            const fetchEmails = (folder) => {
                fetch(`/emails?folder=${folder}`)
                    .then((res) => res.json())
                    .then((data) => {
                        if (data.error) {
                            console.error('Error fetching emails:', data.error);
                        } else {
                            setEmails(data);
                            setView(folder);
                            setSelectedEmail(null);
                            setShowCompose(false);
                        }
                    })
                    .catch((err) => console.error('Error fetching emails:', err));
            };

            const handleSendEmail = (to, subject, content) => {
                fetch('/send-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ to, subject, content }),
                })
                    .then((res) => res.json())
                    .then((data) => {
                        if (data.error) {
                            alert('Error sending email: ' + data.error);
                        } else {
                            alert('Email sent successfully!');
                            fetchEmails('sent');
                        }
                    })
                    .catch((err) => console.error('Error sending email:', err));
            };

            return (
                <div className="flex flex-col h-screen">
                    {/* Header */}
                    <header className="flex items-center justify-between p-4 bg-blue-600 text-white">
                        <h1 className="text-2xl font-bold">LightMail Premium</h1>
                        <button
                            onClick={toggleTheme}
                            className="bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-100 px-2 py-1 rounded"
                        >
                            {isDark ? 'Light Mode' : 'Dark Mode'}
                        </button>
                    </header>
                    {/* Main Content */}
                    <div className="flex flex-1">
                        {/* Sidebar */}
                        <aside className="w-64 bg-gray-200 dark:bg-gray-800 p-4">
                            <button
                                onClick={() => setShowCompose(true)}
                                className="w-full mb-4 px-4 py-2 bg-green-500 text-white rounded"
                            >
                                Compose
                            </button>
                            <nav>
                                <ul>
                                    <li>
                                        <button
                                            onClick={() => fetchEmails('inbox')}
                                            className={`w-full text-left px-2 py-1 rounded ${view === 'inbox' ? 'bg-gray-300 dark:bg-gray-700' : ''}`}
                                        >
                                            Inbox
                                        </button>
                                    </li>
                                    <li>
                                        <button
                                            onClick={() => fetchEmails('sent')}
                                            className={`w-full text-left px-2 py-1 rounded ${view === 'sent' ? 'bg-gray-300 dark:bg-gray-700' : ''}`}
                                        >
                                            Sent
                                        </button>
                                    </li>
                                    <li>
                                        <button
                                            onClick={() => fetchEmails('drafts')}
                                            className={`w-full text-left px-2 py-1 rounded ${view === 'drafts' ? 'bg-gray-300 dark:bg-gray-700' : ''}`}
                                        >
                                            Drafts
                                        </button>
                                    </li>
                                    <li>
                                        <button
                                            onClick={() => fetchEmails('archive')}
                                            className={`w-full text-left px-2 py-1 rounded ${view === 'archive' ? 'bg-gray-300 dark